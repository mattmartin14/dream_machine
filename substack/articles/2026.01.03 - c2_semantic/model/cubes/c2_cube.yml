cubes:
- name: c2_cube
  sql: SELECT * FROM read_csv_auto('/data/workouts/*summary*.csv')

  dimensions:

  - name: id
    sql: "\"Log ID\""
    type: number
    primary_key: true

  - name: "workout_date"
    sql: "\"Date\""
    type: time

  - name: machine
    sql: "Type"
    type: string

  - name: distance_block
    type: string
    case:
      when:
        - sql: "\"Work Distance\" < 1000"
          label: "< 1 km"
        - sql: "\"Work Distance\" between 1000 AND 5000"
          label: "1 km - 5 km"
        - sql: "\"Work Distance\" between 5001 AND 6000"
          label: "5 km - 6 km"
        - sql: "\"Work Distance\" between 6001 AND 7000"
          label: "6 km - 7 km"
        - sql: "\"Work Distance\" >= 7000"
          label: ">= 7 km"

  measures:
  - name: workout_cnt
    type: count

  - name: total_distance_m
    title: "Total Distance (Meters)"
    sql: "\"Work Distance\""
    type: sum

  - name: total_distance_km
    title: "Total Distance (Kilometers)"
    sql: "ROUND(sum(\"Work Distance\") / 1000.0, 2)"
    type: number

  - name: total_strokes
    title: "Total Strokes"
    sql: "\"Stroke Count\""
    type: sum

  - name: total_calolries
    title: "Total Calories Burned"
    sql: "\"Total Cal\""
    type: sum

  - name: watts_avg
    title: "Average Watts"
    sql: "ROUND(AVG(\"Avg Watts\"),2)"
    type: number

  - name: session_duration_min
    title: "Average Session Duration (Minutes)"
    sql: "ROUND(AVG(\"Work Time (Seconds)\"/60.0),2)"
    type: number

  - name: spm
    title: "Average Strokes Per Minute"
    sql: "sum(\"Stroke Count\") / sum(\"Work Time (Seconds)\") * 60.0"
    type: number

  - name: pace
    title: "Average Split Time per 500m (mm:ss.ff)"
    type: string
    sql: |
      CASE
        WHEN SUM("Work Distance") = 0 THEN NULL
        ELSE printf(
          '%d:%05.2f',
          CAST(FLOOR(ROUND((SUM("Work Time (Seconds)") * 500.0) / SUM("Work Distance"), 2) / 60.0) AS INTEGER),
          ROUND(
            ROUND((SUM("Work Time (Seconds)") * 500.0) / SUM("Work Distance"), 2)
            - CAST(FLOOR(ROUND((SUM("Work Time (Seconds)") * 500.0) / SUM("Work Distance"), 2) / 60.0) AS INTEGER) * 60.0,
            2
          )
        )
      END

  - name: drag_factor
    title: "Average Drag Factor"
    sql: "ROUND(AVG(\"Drag Factor\"),2)"
    type: number

  